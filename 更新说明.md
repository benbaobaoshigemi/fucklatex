# 更新说明 - 自动渲染功能整合版

## 🎉 更新内容

### 主要改进
已将 `auto_convert.py` 的自动渲染功能整合到 `main.py` 中，现在只需运行一个程序即可完成全部流程！

### 新功能
1. **一键完成**：LaTeX转换 + 自动渲染 + 打开展示
2. **智能询问**：处理完成后询问是否自动渲染
3. **依赖自动安装**：需要pywin32时自动提示安装
4. **友好提示**：详细的进度显示和操作说明

## 🚀 使用方法

### 最简单的方式
```bash
# 拖拽Word文档到 start.bat
# 或双击 start.bat 后输入文档路径
```

### 完整流程
1. 程序扫描并转换 `$...$` 为Word公式对象
2. 询问："是否自动渲染公式？(y/n)"
3. 输入 `y`：
   - 启动Word
   - 自动扫描所有公式
   - 将线性格式转换为专业格式
   - 保存文档
   - 保持Word打开供查看
4. 输入 `n`：
   - 询问是否直接打开文档
   - 可稍后手动处理

## 📊 技术说明

### 工作原理
1. **第一步**：将 `$\frac{a}{b}$` 转换为 OMML 公式对象（线性格式：`(a)/(b)`）
2. **第二步**：使用 Word COM API 的 `BuildUp()` 方法将线性格式构建为二维专业格式

### 关键修复
- ✅ 正确使用 `doc.StoryRanges` 访问公式对象（而不是直接访问 `doc.OMaths`）
- ✅ 使用 `omath.BuildUp()` 方法渲染公式（而不是修改 `Type` 属性）
- ✅ 遍历所有故事范围（主文档、页眉、页脚等）

## 📁 文件说明

### 核心文件
- `main.py` - **主程序**（包含转换和渲染功能）
- `start.bat` - 快速启动脚本（推荐使用）

### 保留文件
- `auto_convert.py` - 独立的渲染工具（已被整合到main.py，可作为备用）
- `start_auto_convert.bat` - 旧版一键转换+渲染脚本（仍可使用）

### 文档文件
- `使用指南.md` - 详细使用说明（已更新）
- `README.md` - 英文说明
- `重要说明.md` - 技术原理

## 💡 使用建议

### 推荐工作流
```
1. 在LaTeX编辑器中写好公式（使用 $ $ 包裹）
2. 复制到Word文档
3. 拖拽到 start.bat
4. 选择 y 自动渲染
5. 在Word中查看完美的公式效果
```

### 命令行选项
```bash
# 基础用法
python main.py document.docx

# 指定输出文件
python main.py document.docx -o output.docx

# 覆盖原文件
python main.py document.docx --overwrite

# 自动安装依赖
python main.py document.docx --auto-install
```

## ⚠️ 注意事项

1. **pywin32依赖**：自动渲染需要pywin32，首次使用会提示安装
2. **Word版本**：需要安装Microsoft Word（支持COM接口）
3. **文档保护**：原文档不会被修改，会生成新文档
4. **公式格式**：必须使用单个 `$` 包裹（不支持 `$$`）

## 🎯 示例

### 输入（Word文档中）
```
这是一个二次方程求根公式：$x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$

圆的面积公式：$S = \pi r^2$
```

### 输出（自动渲染后）
公式自动转换为Word原生的专业格式，显示为标准的数学公式样式。

---

**版本**: 3.0 - 整合版  
**更新日期**: 2025年10月28日  
**主要改进**: 将转换和渲染整合为一个流程
